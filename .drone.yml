workspace:
  base: /drone
  path: /tmp

pipeline:
  # build:
  #   image: golang:1.9
  #   commands:
  #     - env
  #   when:
  #     event: [push]
  docker_make_tags_file:
    image: eu.gcr.io/bold-upgrade-182112/teston-gcloud
    pull: true
    commands:
      - teston-docker-make-tags-file

  docker_publish_image:
    image: plugins/gcr
    registry: eu.gcr.io
    repo: bold-upgrade-182112/teston-pg
    secrets: [ gcr_json_key ]

  # publish:
  #   image: eu.gcr.io/bold-upgrade-182112/teston-gcloud:latest
  #   secrets: [ gcr_json_key ]
  #   pull: true
  #   commands:
  #     - teston-drone-get-tag commit
  #     - teston-drone-get-tag build
  #     - teston-gcr-login
      # - teston-docker-build-image
    # when:
      # event: push
      # branch: master